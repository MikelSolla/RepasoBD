select * from emple;
SELECT * FROM DEPART;
SET SERVEROUTPUT ON;
--1

CREATE OR REPLACE FUNCTION NMAX_OFICIO
  (P_CODIGO IN DEPART.DEPT_NO%TYPE)
RETURN NUMBER AS
V_MIEMBROS NUMBER;
BEGIN
  SELECT MAX(COUNT(*))INTO V_MIEMBROS
  FROM EMPLE
  WHERE DEPT_NO = P_CODIGO
  GROUP BY DEPT_NO;
RETURN (V_MIEMBROS);
END  NMAX_OFICIO;

DECLARE
V_MIEMBROS NUMBER;
BEGIN
V_MIEMBROS := NMAX_OFICIO (10);
DBMS_OUTPUT.PUT_LINE(V_MIEMBROS );
END;

------------------------

CREATE OR REPLACE FUNCTION NMAX_OFICIO
  (P_OFICIO IN EMPLE.OFICIO%TYPE)
RETURN NUMBER AS
V_MIEMBROS NUMBER;
BEGIN
  SELECT MAX(COUNT(*)) INTO V_MIEMBROS
  FROM EMPLE
  WHERE OFICIO = P_OFICIO
  GROUP BY DEPT_NO;
RETURN (V_MIEMBROS);
END  NMAX_OFICIO;

DECLARE
V_MIEMBROS NUMBER;
BEGIN
V_MIEMBROS := NMAX_OFICIO ('ANALISTA');
DBMS_OUTPUT.PUT_LINE(V_MIEMBROS );
END;

--2
CREATE OR REPLACE PROCEDURE NUM_EMPLE_OFICIO 
(P_OFICIO EMPLE.OFICIO%TYPE,
P_CURSOR OUT SYS_REFCURSOR,
P_ESTADO OUT VARCHAR2)
IS
V_ERROR VARCHAR(250);
BEGIN
IF NMAX_OFICIO(P_OFICIO)
THEN
P_ESTADO:='MAS DE 5 EMPLEADOS';

ELSE IF NMAX_OFICIO(P_OFICIO) IS NULL
THEN P_ESTADO :='NO HAY';
END IF;
OPEN P_CURSOR FOR
    SELECT DEPT_NO,DNOMBRE
    FROM DEPART
    WHERE DEPT_NO IN(SELECT DEPT_NO
                                          FROM EMPLE
                                          WHERE UPPER(OFICIO)=UPPER(P_OFICIO)
                                          GROUP BY DEPT_NO
                                          HAVING COUNT(*) =NMAX_OFICIO(P_OFICIO)
                                          );
                                                                             
   EXCEPTION
   WHEN OTHERS THEN 
   NULL;
   
   END NUM_EMPLE_OFICIO;

--3
DECLARE 
P_DEPARTAMENTOS SYS_REFCURSOR;
P_ESTADO VARCHAR(250);
V_DEPT_NO DEPART.DEPT_NO%TYPE;
V_DNOMBRE DEPART.DNOMBRE%TYPE;

BEGIN
NUM_EMPLE_OFICIO('PROGRAMADOR',P_DEPARTAMENTOS,P_ESTADO);
FETCH P_DEPARTAMENTOS INTO V_DEPT_NO,V_DNOMBRE;
IF P_DEPARTAMENTOS%NOTFOUND THEN
DBMS_OUTPUT.PUT_LINE(P_ESTADO);
ELSE
WHILE P_DEPARTAMENTOS%FOUND LOOP
    DBMS_OUTPUT.PUT_LINE('EL DEPARTAMENTO' ||TO_CHAR(V_DEPT_NO)||''||V_DNOMBRE||'TIENE'||TO_CHAR(NMAX_OFICIO('PROGRAMADOS'))||'EMPLEADOS'||P_ESTADO);
    FETCH P_DEPARTAMENTOS INTO V_DEPT_NO,V_DNOMBRE;
END LOOP;
END IF;
END;



































